<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>FullCalendar ドラッグ＆ドロップスケジュール</title>
    <link
      href="https://unpkg.com/fullcalendar@5/main.min.css"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/fullcalendar@5/main.min.js"></script>
    <script src="https://unpkg.com/@fullcalendar/interaction@5"></script>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        font-family:
          Arial,
          Helvetica Neue,
          Helvetica,
          sans-serif;
        font-size: 14px;
      }

      #external-events {
        position: fixed;
        z-index: 2;
        top: 20px;
        left: 20px;
        width: 150px;
        padding: 0 10px;
        border: 1px solid #ccc;
        background: #eee;
      }

      #external-events .fc-event {
        cursor: move;
        margin: 3px 0;
        background-color: #3788d8;
        color: white;
        border: 1px solid #3788d8;
        padding: 2px 4px;
      }

      #calendar-container {
        position: relative;
        z-index: 1;
        margin-left: 200px;
      }

      #calendar {
        max-width: 1100px;
        margin: 20px auto;
      }

      #reset-events {
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <div id="external-events">
      <p><strong>Draggable Events</strong></p>
      <div class="fc-event" data-duration="00:30">タスク整理 - 0.5H</div>
      <div class="fc-event" data-duration="01:00">昼休み - 1.0H</div>
      <div class="fc-event" data-duration="02:00">資料作成 - 2.0H</div>
      <div class="fc-event" data-duration="01:00">MTG - 1.0H</div>
      <div class="fc-event" data-duration="06:00">○○機能の改修 - 6.0H</div>
      <p>
        <input type="checkbox" id="drop-remove" />
        <label for="drop-remove">remove after drop</label>
      </p>
      <button id="reset-events">Reset Events</button>
    </div>
    <div id="calendar-container">
      <div id="calendar"></div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
          initialView: 'timeGridWeek',
          editable: true,
          droppable: true,
          eventReceive: function (info) {
            console.log('Received new event:', info.event.title);
          },
          eventDrop: function (info) {
            console.log('Event dropped:', info.event.title);
          },
          headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,timeGridDay',
          },
          drop: function (info) {
            if (document.getElementById('drop-remove').checked) {
              info.draggedEl.parentNode.removeChild(info.draggedEl);
            }
          },
        });

        // Initialize draggable events
        var containerEl = document.getElementById('external-events');
        new FullCalendar.Draggable(containerEl, {
          itemSelector: '.fc-event',
          eventData: function (eventEl) {
            return {
              title: eventEl.innerText.split(' - ')[0],
              duration: eventEl.getAttribute('data-duration'),
              extendedProps: {
                duration: eventEl.getAttribute('data-duration'),
              },
            };
          },
        });

        // Enable dragging events from the calendar back to the task list
        calendar.on('eventDragStop', function (info) {
          var externalEventsEl = document.getElementById('external-events');
          var rect = externalEventsEl.getBoundingClientRect();
          var x = info.jsEvent.clientX;
          var y = info.jsEvent.clientY;

          if (
            x >= rect.left &&
            x <= rect.right &&
            y >= rect.top &&
            y <= rect.bottom
          ) {
            var eventData = {
              title:
                info.event.title + ' - ' + info.event.extendedProps.duration,
              duration: info.event.extendedProps.duration,
            };

            var newEventEl = document.createElement('div');
            newEventEl.className = 'fc-event';
            newEventEl.textContent = eventData.title;
            newEventEl.setAttribute('data-duration', eventData.duration);
            externalEventsEl.appendChild(newEventEl);

            info.event.remove(); // Remove the event from the calendar
          }
        });

        calendar.render();

        // Reset events button functionality
        document
          .getElementById('reset-events')
          .addEventListener('click', function () {
            var events = [
              { title: 'タスク整理 - 0.5H', duration: '00:30' },
              { title: '昼休み - 1.0H', duration: '01:00' },
              { title: '資料作成 - 2.0H', duration: '02:00' },
              { title: 'MTG - 1.0H', duration: '01:00' },
              { title: '○○機能の改修 - 6.0H', duration: '06:00' },
            ];
            var externalEventsContainer =
              document.getElementById('external-events');
            externalEventsContainer.innerHTML =
              '<p><strong>Draggable Events</strong></p>';
            events.forEach(function (event) {
              var eventEl = document.createElement('div');
              eventEl.className = 'fc-event';
              eventEl.textContent = event.title;
              eventEl.setAttribute('data-duration', event.duration);
              externalEventsContainer.appendChild(eventEl);
            });
            externalEventsContainer.innerHTML +=
              '<p><input type="checkbox" id="drop-remove" /><label for="drop-remove">remove after drop</label></p><button id="reset-events">Reset Events</button>';
          });
      });
    </script>
  </body>
</html>
